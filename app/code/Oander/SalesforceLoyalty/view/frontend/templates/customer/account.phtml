<?php
/**
 * New Customer block template
 *
 * @var $block \Oander\SalesforceLoyalty\Block\Customer\Account
 */
?>

<?php
    if ($block->getCustomerLoyaltyStatus() == 1) {
        echo $block->getLayout()->createBlock(\Magento\Cms\Block\Block::class)->setBlockId($block->getBlockId())->toHtml();
    } elseif ($block->getCustomerLoyaltyStatus() == 2) {
?>
    <?php
    echo $this->getLayout()
    ->createBlock('Magento\Cms\Block\Block')
    ->setBlockId('loyalty_profile_block')
    ->toHtml();
    ?>

    <div class="block block--loyalty-account">
        <div class="block__head">
            <div class="row">
                <div class="col-6">
                    <div class="block__col">
                        <p class="block__title"><?= __('Loyalty ID') ?></p>
                        <span><?php echo $block->getSalesforceId() ?></span>
                    </div>
                </div>
                <div class="col-6">
                    <div class="block__col">
                        <p class="block__title"><?= __('Available points') ?></p>
                        <span><?php echo $block->getLoyaltyPoints() ?></span>
                    </div>
                </div>
            </div>
        </div>
        <div class="block__content">
            <div class="block block--loyaltyhistory">
                <div class="block__table">
                    <table id="loyaltyhistory" class="table table-striped table--loyalty">
                        <thead>
                            <tr>
                                <td><b><?= __('Transaction date') ?></b></td>
                                <td><b><?= __('Transaction type') ?></b></td>
                                <td><b><?= __('Transaction points') ?></b></td>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
                <div class="block__load">
                    <img src="<?php /* @escapeNotVerified */ echo $block->getViewFileUrl('images/loader-1.gif'); ?>" alt="<?= __('Loading') ?>" title="<?= __('Loading') ?>">
                </div>
                <div class="block__pagination">
                    <div class="pages">
                        <ul class="items"></ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="text/x-magento-init">
        {
            "#loyaltyhistory": {
                "salesforceLoyaltyHistory": <?php /* @noEscape */ echo $block->getScriptOptions(); ?>
            }
        }
    </script>
<?php } else { ?>
    <div class="row">
        <div class="col-12 col-lg-8">
            <?=   $block->getLayout()->createBlock(\Magento\Cms\Block\Block::class)->setBlockId($block->getPromoBlockId())->toHtml();?>
            <form
                id="registration"
                action="/salesforceloyalty/customer/loyaltyregistrationprocess"
                class="loyalty-registration profile"
            >
                <div class="form-group">
                    <?=  $block->getLayout()
                        ->createBlock('Oander\SalesforceLoyalty\Block\SuccessPage\Agreements')
                        ->setTemplate('Magento_Customer::form/register-agreements.phtml')
                        ->toHtml();
                    ?>
                </div>
                <input
                    id="loyalty-registration"
                    type="submit"
                    class="action primary"
                    value="<?php /* @escapeNotVerified */ echo __('Loyalty subscription') ?>"
                    disabled
                >
                <script type="text/javascript">
                    require(['jquery'], function($) {
                        $(function() {
                            $('#registration.loyalty-registration .checkbox').on('change', function() {
                                if ($(this).is(':checked')) {
                                    $('#loyalty-registration').removeAttr('disabled');
                                } else {
                                    $('#loyalty-registration').attr('disabled', 'disabled');
                                }
                            });
                        });
                    });
                </script>
            </form>
            <div class="reg-messages messages">
                <div class="message"></div>
            </div>
        </div>
    </div>
<?php } ?>
